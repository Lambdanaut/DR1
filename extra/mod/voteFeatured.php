<?phprequire_once ("extra/library.php");$neededVotes = ceil(mysql_num_rows(mysql_query("select id from user_data where moderator >= '1'") ) / 3) ;require '../lib/session.php';$cookiename = $_SESSION['user']['data']['username'];$cookiepass = $_SESSION['user']['data']['password'];$voteID     = bbsclean($_POST['id']);mysql_query("select * from user_data where username = '".$cookiename."' and password = '".$cookiepass."' and moderator > 0");if(mysql_affected_rows() != 0) {	//Check that a mod isn't voting twice	if (0 == mysql_num_rows(mysql_query("select id from featuredVote where owner = '".$cookiename."' and location = '".$voteID."'") ) ) {		mysql_query("insert into featuredVote (owner, location) VALUES ('".$cookiename."','".$voteID."')");		$reason    = mysql_fetch_array(mysql_query("select * from featuredProp where id = '".$voteID."'"));			$votesfor  = mysql_query("select * from featuredVote where location = '".$voteID."'");		$voteScore = mysql_num_rows($votesfor);		if ($voteScore >= $neededVotes) {			//Feature Art			mysql_query("insert into featuredArt (location, reason) VALUES ('".$reason['location']."','".$reason['reason']."')") or die (mysql_error());			//Delete proposition and votes from database			mysql_query("delete from featuredProp where id = '".$voteID."'");			mysql_query("delete from featuredVote where location = '".$voteID."'");			echo("The art has recieved \"".$neededVotes."\" and has become featured! ");		} else {			//Echo back amount of votes needed to feature			echo("Current Votes/Needed Votes to Feature  ::  ".$voteScore."/".$neededVotes);		}	} else {echo("The system has detected a double vote and has blocked your vote. ");}}mysql_close($con);?>